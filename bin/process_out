#!/bin/bash

# Parse the compact output generated by omnetpp when the
# option 'cmdenv-performance-display = false' is present
# in the omnetpp.ini file
for INPUT_FILE in run_*/out.log
do
    OUTPUT_FILE="${INPUT_FILE%%/*}.csv"
    # Generate a csv file from the log
    echo '"Event #","Simulated Time","Elapsed Time","Events per Second"' > $OUTPUT_FILE
    # this command applies consecutive substitutions to the output text (sample below)
    # ** Event #1622183424   T=1754.33044188773   Elapsed: 1838.679s (30m 38s)  2% completed   ev/sec=879488
    sed --quiet '{s/^.*#//; s/\s*T=/,/; s/ .*: /,/; s/s .*=/,/p}' $INPUT_FILE >> $OUTPUT_FILE
done

exit 0
