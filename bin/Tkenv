#!/bin/bash

if [[ $# -lt 1 || $# -gt 2 ]]; then
    echo "Usage: $0 <run> [CONFIG]"
    exit 1
fi

# script configuration
#EXEC_FILE="./BitTorrent" # path to the simulation executable
EXEC_FILE="../src/EbitSim" # path to the simulation executable
INI_FILE="../simulations/BasicConfig.ini" # path to the configuration file
if [[ $# == 2 ]]; then
    CONFIG=$2
else
    CONFIG="SimpleTopology" # name of the configuration
fi
#CONFIG="BigScope" # name of the configuration
ENV="Tkenv" # TK environment
LOG_DIR="./logs/run_$1"
ERR_FILE="err.log" # the log file where all error messages will be written
OUT_FILE="out.log" # the log file where all log messages will be written
PWD=pwd # the directory where this script is called

# error if the executable file don't exist
if [ ! -e $EXEC_FILE ]
then
    echo "Executable file \"$EXEC_FILE\" not found."
    exit 1;
fi

# error if the config file don't exist
if [ ! -e $INI_FILE ]
then
    echo "Initaliazation file \"$INI_FILE\" not found."
    exit 1;
fi

# create the log directory if it don't exist
if [ ! -d "$LOG_DIR" ]
then
    mkdir -p "$LOG_DIR"
fi

# execute the simulation with the passed parameters and send the output to zenity progress dialog
$EXEC_FILE -f $INI_FILE -c $CONFIG -u $ENV -r$1 2> $LOG_DIR/$ERR_FILE > $LOG_DIR/$OUT_FILE
